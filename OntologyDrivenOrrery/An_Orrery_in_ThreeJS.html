<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Ontology-driven Orrery</title>
		<style>
			body { margin: 0; }
			canvas { width: 50%; height: 50% }
		</style>
	</head>
	<body>
	    <script src="http://cdnjs.cloudflare.com/ajax/libs/jsonld/0.3.15/jsonld.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r79/three.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script src="TrackballControls.js"></script>
		<script src="OrbitalPropagator.js"></script>
<!--	<script src="compacted_OrbitalOntology.jsonld"  type="application/ld+json" id="datablock"></script>  -->
        <script id="OrbitOntology" type="application/ld+json">
 {
  "@context": {
    "HelioCentricOrbit": "http://www.semanticweb.org/rrovetto/ontologies/2014/ssao#Helio-Centric_Orbit",
    "CelestialEntity": "http://www.w3.org/2002/07/owl#NamedIndividual",
    "Name": "http://www.w3.org/2001/XMLSchema#Name",
    "name": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_name",
    "semiMajorAxis": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_Semi-major_Axis",
    "eccentricity": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_orbital_eccentricity",
    "inclination": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_orbital_inclination",
    "meanAnomoly": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_Mean_Anomaly",
    "argPerigee": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_Argument_of_Periapsis",
    "sidereal": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_Eccentric_Anomaly",
    "raan": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_RAAN",
    "double": "http://www.w3.org/2001/XMLSchema#double",
    "decimal": "http://www.w3.org/2001/XMLSchema#decimal",
    "graph": "@graph",
    "type": "@type",
    "value": "@value"
  },
  "graph": [
    {
      "@id": "http://www.semanticweb.org/daoneil/ontologies/2016/7/untitled-ontology-34",
      "type": "http://www.w3.org/2002/07/owl#Ontology",
      "http://www.w3.org/2002/07/owl#imports": {
        "@id": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology"
      }
    },
    {
      "@id": "http://www.semanticweb.org/daoneil/ontologies/2016/7/untitled-ontology-34#Earth_Orbit",
      "type": [
        "CelestialEntity",
        "HelioCentricOrbit"
      ],
      "argPerigee": {
        "type": "decimal",
        "value": "100.47"
      },
      "sidereal": {
        "type": "decimal",
        "value": "1"
      },
      "meanAnomoly": {
        "type": "decimal",
        "value": "100.47"
      },
      "raan": {
        "type": "decimal",
        "value": "-11.26064"
      },
      "semiMajorAxis": {
        "type": "decimal",
        "value": "1.00000011"
      },
      "name": {
        "type": "Name",
        "value": "Earth_Orbit"
      },
      "eccentricity": {
        "type": "decimal",
        "value": "0.01671022"
      },
      "inclination": {
        "type": "decimal",
        "value": "0.00005"
      }
    },
    {
      "@id": "http://www.semanticweb.org/daoneil/ontologies/2016/7/untitled-ontology-34#Mars_Orbit",
      "type": [
        "CelestialEntity",
        "HelioCentricOrbit"
      ],
      "argPerigee": {
        "type": "decimal",
        "value": "336.04084084"
      },
      "sidereal": {
        "type": "decimal",
        "value": "1.881"
      },
      "meanAnomoly": {
        "type": "decimal",
        "value": "355.43"
      },
      "raan": {
        "type": "decimal",
        "value": "49.57854"
      },
      "semiMajorAxis": {
        "type": "decimal",
        "value": "1.5236623"
      },
      "name": {
        "type": "Name",
        "value": "Mars_orbit"
      },
      "eccentricity": {
        "type": "decimal",
        "value": "0.09341233"
      },
      "inclination": {
        "type": "decimal",
        "value": "1.85061"
      }
    },
    {
      "@id": "http://www.semanticweb.org/daoneil/ontologies/2016/7/untitled-ontology-34#Mercury_Orbit",
      "type": [
        "CelestialEntity",
        "HelioCentricOrbit"
      ],
      "argPerigee": {
        "type": "decimal",
        "value": "77.46"
      },
      "sidereal": {
        "type": "decimal",
        "value": "0.240846"
      },
      "meanAnomoly": {
        "type": "decimal",
        "value": "252.25"
      },
      "raan": {
        "type": "decimal",
        "value": "48.33167"
      },
      "semiMajorAxis": {
        "type": "decimal",
        "value": "0.38709893"
      },
      "name": {
        "type": "Name",
        "value": "Mercury_Orbit"
      },
      "eccentricity": {
        "type": "decimal",
        "value": "0.20563069"
      },
      "inclination": {
        "type": "decimal",
        "value": "7.00487"
      }
    },
    {
      "@id": "http://www.semanticweb.org/daoneil/ontologies/2016/7/untitled-ontology-34#Venus_Orbit",
      "type": [
        "CelestialEntity",
        "HelioCentricOrbit"
      ],
      "argPerigee": {
        "type": "decimal",
        "value": "131.77"
      },
      "sidereal": {
        "type": "decimal",
        "value": "0.615"
      },
      "meanAnomoly": {
        "type": "decimal",
        "value": "181.98"
      },
      "raan": {
        "type": "decimal",
        "value": "76.68069"
      },
      "semiMajorAxis": {
        "type": "decimal",
        "value": "0.72333199"
      },
      "name": {
        "type": "Name",
        "value": "Venus_Orbit"
      },
      "eccentricity": {
        "type": "decimal",
        "value": "0.00677323"
      },
      "inclination": {
        "type": "decimal",
        "value": "3.39471"
      }
    },
    {
      "@id": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_Argument_of_Periapsis",
      "http://www.semanticweb.org/rrovetto/ontologies/2014/ssao#Reference_Source": "http://farside.ph.utexas.edu/teaching/celestial/Celestial/node34.html"
    },
    {
      "@id": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_Mean_Anomaly",
      "http://www.semanticweb.org/rrovetto/ontologies/2014/ssao#Reference_Source": "http://farside.ph.utexas.edu/teaching/celestial/Celestial/node34.html",
      "http://www.w3.org/2000/01/rdf-schema#comment": "Mean Anomoly at Epoch"
    },
    {
      "@id": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_Semi-major_Axis",
      "http://www.w3.org/2000/01/rdf-schema#comment": "Value in Astronomical Units"
    },
    {
      "@id": "http://www.semanticweb.org/rrovetto/ontologies/2014/space-situational-awareness-ontology#has_orbital_inclination",
      "http://www.semanticweb.org/rrovetto/ontologies/2014/ssao#Reference_Source": "http://www.met.rdg.ac.uk/~ross/Astronomy/Planets.html"
    }
  ]
}
        </script>
		<script>
        var camera ;
		var controls ;         // Declare global variables
		var scene ;
		var cube ;
		var sphere ;
		var line ;
		var objNames = ["Earth_Orbit", "Mars_orbit", "Mercury_Orbit", "Venus_Orbit"] ;
		var objSizes = [0.2, 0.17, 0.07, 0.2] ;
		var objColors = [0x0066FF, 0xCC3333, 0xFF0000, 0xFFFFFF] ;
		var curObj = new THREE.Object3D();
		var celestialBody ;
		var heavenlyBodies = [] ;
		
		function init() {
            camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

			controls = new THREE.TrackballControls( camera );
				controls.rotateSpeed = 1.0;
				controls.zoomSpeed = 1.2;
				controls.panSpeed = 0.8;
				controls.noZoom = false;
				controls.noPan = false;
				controls.staticMoving = true;
				controls.dynamicDampingFactor = 0.3;
				controls.keys = [ 65, 83, 68 ];
				controls.addEventListener( 'change', render );
				
			scene = new THREE.Scene();
								
            renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth/2, window.innerHeight/2);
            document.body.appendChild( renderer.domElement );
			

		    var j = 0 ;
		//  Here comes the Sun!
			var geometry = new THREE.SphereGeometry( 0.6, 16, 16 );
			var material = new THREE.MeshBasicMaterial( {color: 0xFFFF00, wireframe: false} );
            sphere = new THREE.Mesh( geometry, material );
			scene.add( sphere );
			
			var light = new THREE.PointLight( 0xff0000, 1, 100 );
            light.position.set( 0, 0, 0 );           
            scene.add( light );                       // currently no effect
			
			for (i = 0; i < 4; i++) { // Add the inner planets.
		
			 geometry = new THREE.SphereGeometry( objSizes[j], 16, 16 );
		     material = new THREE.MeshBasicMaterial( {color: objColors[j], wireframe: false} );
             sphere = new THREE.Mesh( geometry, material );
			 
			 sphere.name = objNames[i] ;
             scene.add( sphere );
			 
			  j = j + 1 ;
			} 
			camera.position.z = 5;
			
		//	console.log(scene) ;
		
		}
		</script>
<div></div>
<div id="planetary_orbits"></div>
<!-- <i>RAAN = Right Ascension of Ascending Node</i>
 <p id="modelDate">December 9, 2014</p> -->
 <table border='1'><caption>The spheres are animated by an orbital propagator using the following parameters.</caption><tr><th>Name</th><th>Arg.Perigee</th><th>Mean Anomoly</th><th>Eccentricty</th><th>Inclination</th><th>SemiMajor Axis</th><th>RAAN</th><th>Period</th></tr>
 <tr><td id="r1c1"></td><td id="r1c2"></td><td id="r1c3"></td><td id="r1c4"></td><td id="r1c5"></td><td id="r1c6"></td><td id="r1c7"></td><td id="r1c8"></td></tr>
 <tr><td id="r2c1"></td><td id="r2c2"></td><td id="r2c3"></td><td id="r2c4"></td><td id="r2c5"></td><td id="r2c6"></td><td id="r2c7"></td><td id="r2c8"></td></tr>
 <tr><td id="r3c1"></td><td id="r3c2"></td><td id="r3c3"></td><td id="r3c4"></td><td id="r3c5"></td><td id="r3c6"></td><td id="r3c7"></td><td id="r3c8"></td></tr>
 <tr><td id="r4c1"></td><td id="r4c2"></td><td id="r4c3"></td><td id="r4c4"></td><td id="r4c5"></td><td id="r4c6"></td><td id="r4c7"></td><td id="r4c8"></td></tr> 
</table> 

		
		<script>
		//-------------------------------------------
 	 	function render() {
	           requestAnimationFrame( render );
	           renderer.render( scene, camera );
              }  
   		  function animate() {
				requestAnimationFrame( animate );
				controls.update();
				updatePosition() ;
			}

     function populate_table(rowNum,name,argP,meanA,ecc,inc,sma,raan,per) {
	     console.log(rowNum + "  " + name + "," + argP + "," + meanA + "," + ecc);
		 var cellID = "r" + rowNum + "c1"; console.log(cellID);
		 cellID = "r" + rowNum + "c1"    ; document.getElementById(cellID).textContent = name;
         cellID = "r" + rowNum + "c2"    ; document.getElementById(cellID).textContent = argP;
         cellID = "r" + rowNum + "c3"    ; document.getElementById(cellID).textContent = meanA;
         cellID = "r" + rowNum + "c4"    ; document.getElementById(cellID).textContent = ecc;
         cellID = "r" + rowNum + "c5"    ; document.getElementById(cellID).textContent = inc;
         cellID = "r" + rowNum + "c6"    ; document.getElementById(cellID).textContent = sma;
         cellID = "r" + rowNum + "c7"    ; document.getElementById(cellID).textContent = raan;
         cellID = "r" + rowNum + "c8"    ; document.getElementById(cellID).textContent = per;
	  
	 }
	 
   function get_datablock() {

     // Reference https://stackoverflow.com/questions/38602543/is-there-a-way-to-access-json-ld-via-javascript-if-it-doesnt-have-an-id
	    // var jsonld = document.querySelectorAll('script[type="application/ld+json"]').innerText;
		var jsonld = document.querySelector('#OrbitOntology').innerText;
         var result = JSON.parse(jsonld);
       // console.log(result.graph[1].name.value);		
		
	  //   $.each(result.graph, function(i, field){
	      for(i = 1; i < result.graph.length; i++) {
		   field = result.graph[i];
		   if (i > 0 && i < 5) { // alert(field.name.value) ; 
		
		   //smA,oI,aP,oE,aN,mAe,Sidereal
             celestialBody = new Trajectory(field.name.value,
		                             field.semiMajorAxis.value,
									 field.inclination.value,
									 field.argPerigee.value,
									 field.eccentricity.value,
									 field.raan.value,
									 field.meanAnomoly.value,
									 field.sidereal.value) ;
			 
			 heavenlyBodies.push(celestialBody) ;
		   	
			populate_table(i,field.name.value,
                            field.argPerigee.value, 
                            field.meanAnomoly.value,
                            field.eccentricity.value,
                            field.inclination.value,
                            field.semiMajorAxis.value,
                            field.raan.value,
                            field.sidereal.value) ;
	
		   }		 

		 }
}

//----------------------------------
            init() ;
			get_datablock() ;	
			traceOrbits() ;
			animate() ;
		  
		</script>
	</body>
</html>